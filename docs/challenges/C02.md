# O'kanban - SPA E02 - CRUD & Drag & Drop

## √âtape 1 - On relance les serveurs

On rappelle √† toute fin utile qu'il faut lancer le frontend ET le backend ind√©pendamment pour que les deux puissent communiquer üó£Ô∏è.

## √âtape 2 - Modifier une liste

### 2.1. Cr√©er une modale d'√©dition de liste

Dans le HTML, s'inspirer de la modale d'ajout de liste existante et cr√©er une nouvelle modale pour l'√©dition du titre d'une liste.

> **ASTUCE** l'afficher avec la classe `is-active` (cod√©e en dur) pour la tester, puis retirer cette classe que l'on ajoutera dynamiquement suite √† une interaction de l'utilisateur.
> On peut √©galement passer par les _Dev Tools_ du navigateur pour ajouter/retirer la classe en manipulant directement le DOM (onglet `Inspecteur` (Firefox) ou `Elements` (Chrome)`).

### 2.2. Cr√©er le bouton d'√©dition

Dans le HTML, modifier le template d'une liste pour ajouter une ic√¥ne ¬´ crayon ¬ª üñçÔ∏è √† l'aide de la librairie Font Awesome d√©j√† en place.

On peut s'inspirer du code existant pour le bouton ¬´ plus ¬ª ‚ûï.

### 2.3. Ouvrir la modale

Lors d'un clic sur ce bouton, depuis n'importe quelle liste, on souhaite ouvrir la modale d'√©dition. Pour cela, il faut poser un _listener_ sur ce bouton.

**Probl√®me** : √† l'ouverture de la page par l'utilisateur, les listes ne sont pas encore pr√©sentes dans le DOM, puisque le frontend doit les `fetch` au pr√©alable.

**Solution** : on peut poser le _listener_ directement sur le clone avant son insertion dans le DOM, c'est-√†-dire dans la fonction `addListToListsContainer`.

<details><summary>Un peu d'aide ?</summary>

```js
function addListToListsContainer(listData) {
  // ...

  const editListButton =
    listClone.querySelector(/* S√âLECTEUR pour le bouton üñçÔ∏è situ√© dans le clone */);
  editListButton.addEventListener("click", () => {
    // Ouvrir la modale d'√©dition de liste
  });
}
```

</details>

**Probl√®me** : une fois la modale ouverte, impossible de savoir via quelle liste celle-ci a √©t√© ouverte !

**Solution** : on pourrait ajouter dans les [dataset](https://developer.mozilla.org/fr/docs/Learn/HTML/Howto/Use_data_attributes) de la modale d'√©dition,
l'ID de la liste que l'utilisateur souhaite modifier !

<details><summary>Un peu d'aide ?</summary>

```js
function addListToListsContainer(listData) {
  // ...

  const editListButton =
    listClone.querySelector(/* S√âLECTEUR pour le bouton üñçÔ∏è situ√© dans le clone */);
  editListButton.addEventListener("click", () => {
    // Ouvrir la modale d'√©dition de liste

    const editListModal =
      document.querySelector(/* S√âLECTEUR pour la modale d'√©dition */);
    editListModal.dataset.listId = listData.id;
  });
}
```

> **NOTE** vous pouvez utiliser l'inspecteur (onglet `Inspecteur` ou `Element`) pour constater le r√©sultat :
> lorsque vous ouvrez la modale, celle-ci pr√©sente dans son HTML l'attribut `data-list-id="X"` o√π `X` est l'ID de la liste choisie.

</details>

### 2.4. Soumission du formulaire

De mani√®re similaire au formulaire d'ajout d'une liste :

- √©couter la soumission du formulaire de modification d'une liste ;
- r√©cup√©rer les donn√©es du formulaire ;
- faire une requ√™te `PATCH` vers la route `/lists/:id` ;
  > l'ID de la liste √† modifier se trouve dans les `dataset` de la modale, comme vu √† l'√©tape pr√©c√©dente !
- r√©cup√©rer le r√©sultat de la requ√™te ;
- mettre √† jour la liste sur la page, avec son nouveau titre ;
- fermer la modale ;
- re-initialiser le formulaire.

<details><summary>Un peu d'aide ?</summary>

```js
// S√©lectionner le formulaire d'√©dition de liste
//
// √âcouter l'√©v√®nement `submit` sur ce formulaire, auquel cas :
// - emp√™cher le comportement par d√©faut du formulaire
// - r√©cup√©rer les donn√©es du formulaire (le nouveau titre)
// - r√©cup√©rer l'ID de la liste √† modifier dans les dataset de la modale
// - PATCH `/lists/:listId` avec comme body { "title": "..." }
// - r√©cup√©rer le r√©sultat de la requ√™te PATCH, et en cas de succ√®s
// - s√©lectionner la liste du DOM correspondant au bon ID
// - modifier le contenu de l'√©l√©ment avec le slot `list-title` avec le nouveau titre choisi
// - fermer la modale
// - reset le formulaire
//
// Festoyer ! Tres fort !
```

</details>

---

‚ö†Ô∏è **Les deux parties suivantes sont ind√©pendantes.** ‚ö†Ô∏è

---

## √âtape 3 - Suppression d'une liste

Bon bah, rebelote, hein ü§™ !

Cette fois-ci, un peu plus d√©brouillard :

- ajouter un bouton de suppression sur les listes ;
- ouvrir une modale de ¬´ confirmation avant suppression ¬ª ;

  > **BONUS** si la liste poss√®de des cartes :
  >
  > - pr√©venir que la suppression supprimera √©galement toutes les cartes √† l'int√©rieur ;
  > - OU emp√™cher explicitement l'utilisateur de supprimer une liste qui poss√®de des cartes.

- suite √† la confirmation de la suppression, faire une requ√™te `DELETE` vers l'API pour supprimer la liste ;
- retirer la liste de la page ;
- fermer la modale.

## (Bonus) √âtape 4 - Drag & Drop

On souhaiterait pouvoir modifier la **position** des listes sur le Kanban, en glissant-d√©posant une liste vers un nouvel emplacement.

**Probl√®me :** _on va quand m√™me pas le faire √† la main üôÄ ?_

**Solution :** _et bah non !_ Il existe des solutions cl√©-en-main pour la partie frontend.

## 4.1. Installation

Jeter un ≈ìil √† la [documentation](https://github.com/SortableJS/Sortable) de `SortableJS`,
aux [d√©monstrations](http://sortablejs.github.io/Sortable/),
et l'installer dans le code en utilisant le script fourni via un [CDN](https://github.com/SortableJS/Sortable?tab=readme-ov-file#cdn).

> **NOTE** ce script externe doit √™tre charg√© AVANT nos scripts, sinon il ne sera pas possible d'utiliser la variable globale `Sortable`.

## 4.2. Mise en place (frontend)

Objectif n¬∞1 : r√©ussir √† logger en `console` l'ID de la liste qui vient d'√™tre d√©plac√©.

<details><summary>Un peu d'aide ?</summary>

```js
Sortable.create(ELEMENT_DU_DOM_CONTENANT_LISTES, {
  onEnd(event) {
    // Callback qui se d√©clenche lorsque l'utilisateur d√©place une liste
    console.log(event);
  },
});
```

</details>

## 4.3. Mise √† jour (backend)

Objectif n¬∞2 : r√©ussir √† sauvegarder la position actuelle de toutes les listes.

Pour **chaque** liste sur la page, r√©cup√©rer sa position et ex√©cuter une requ√™te `PATCH /lists/:listId` (avec le bon body) afin de sauvegarder sa nouvelle position.

> **NOTE** cette approche n'est absolument pas performante, car on lance **une requ√™te HTTP par liste**,
> ce qui peut faire beaucoup selon le nombre de listes pr√©sentes sur la page !  
> Id√©alement, on aimerait uniquement mettre √† jour la liste qui vient d'√™tre d√©plac√©. Nous discuterons en cours d'autres impl√©mentations et mod√©lisations possibles.

<details><summary>Un peu d'aide</summary>

```js
// Dans le callback 'onEnd'

// S√©lectionner toutes les listes sur la page
// Pour chaque liste :
// - r√©cup√©rer son ID
// - r√©cup√©rer sa position
// - faire l'appel PATCH /lists/:listId avec BODY { position: X }
```

</details>
