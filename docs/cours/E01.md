# API E06 - HTML `template` & AJAX `fetch`

```
=== Matin COURS ===

- Rappels d'architecture client-serveur
- Révisions de manipulation du DOM
- Découverte des templates HTML
- Découverte de l'AJAX avec fetch
- Prise en main de l'intégration

=== Aprem ATELIER ===

- (Révisions) Ouverture / fermeture modale
- (GET) Fetch des listes & ajout de liste via template HTML
- (POST) Formulaire et insertion de liste
```

## Sommaire

### DOM

- [Savoir récuperer un élément dans le DOM](#savoir-récuperer-un-élément-dans-le-dom)
- [Savoir modifier le style d'un élément](#savoir-modifier-le-style-dun-élément)
- [Savoir ajouter ou supprimer une classe d'un element](#savoir-ajouter-ou-supprimer-une-classe-dun-element)
- [Savoir modifier le contenu d'un élément](#savoir-modifier-le-contenu-dun-élément)
- [Savoir réagir à un événement](#savoir-réagir-à-un-événement)
- [e.target](#etarget)
- [Récuperer plusieurs éléments d'un coup](#récuperer-plusieurs-éléments-dun-coup)
- [Créer un élément et l'inserer dans le DOM](#créer-un-élément-et-linserer-dans-le-dom)
- [Savoir utiliser les templates](#savoir-utiliser-les-templates)
- [Récuperer les données d'un formulaire](#récuperer-les-données-dun-formulaire)

### Requêtes Fetch

- [Requête GET](#requête-get)
- [Requête POST](#requête-post)

## Cours

### Savoir récuperer un élément dans le DOM

Deux méthodes :

- `document.getElementById` permet de récuperer un élément par son id. par exemple `document.getElementById('monId')` récuperera l'élément de la page qui a l'id `monId`.

```javascript
// Récuperer un élément par son id
const monElement = document.getElementById("monId");
```

- `document.querySelector` permet de récuperer un élément par son sélecteur CSS. par exemple `document.querySelector('.maClasse')` récuperera le premier élément de la page qui a la classe `maClasse`.

```javascript
// Récuperer un élément par sa classe
const monElement = document.querySelector(".maClasse");
```

Les deux methodes sont équivalentes, on utilise l'une ou l'autre selon la situation.

### Savoir modifier le style d'un élément

Pour modifier le style d'un élément, on utilise la propriété `style` de l'élément. Par exemple pour changer la couleur de fond d'un élément :

```javascript
const monElement = document.getElementById("monId");
monElement.style.backgroundColor = "red";
```

### Savoir ajouter ou supprimer une classe d'un element

```javascript
// Récuperer un élément par son id
const monElement = document.getElementById("monId");

// Ajouter la classe "unerline" à l'élément
monElement.classList.add("underline");

// Supprimer la classe "underline" de l'élément
monElement.classList.remove("underline");

// Bien entendu il faut avoir défini la classe "underline" dans un fichier css
```

### Savoir modifier le contenu d'un élément

Pour modifier le contenu d'un élément, on utilise la propriété `textContent` de l'élément. Par exemple pour changer le texte d'un élément :

```javascript
const monElement = document.getElementById("monId");
monElement.textContent = "Nouveau texte";
```

### Savoir réagir à un événement

Pour réagir à un événement, on utilise la méthode `addEventListener` de l'élément. Par exemple pour réagir au clic sur un élément :

```javascript
const monElement = document.getElementById("monId");
monElement.addEventListener("click", function () {
  console.log("L'élément a été cliqué !");
});
```

Il existe de nombreux événements auxquels on peut réagir, comme le clic, le "submit" (pour les formulaires), le "change" (pour les champs de formulaire), le "mouseover" (quand la souris passe sur l'élément), etc.

### e.target

Lorsqu'on réagit à un événement, la fonction qui est appelée recoit un argument `e` qui représente l'événement. Cet objet contient de nombreuses informations sur l'événement, notament `e.target` qui représente l'élément sur lequel l'événement a été déclenché. Par exemple :

```javascript
const monElement = document.getElementById("monId");
monElement.addEventListener("click", function (e) {
  console.log("L'élément a été cliqué !");
  console.log("L'élément cliqué est : ", e.target);
  console.log("Son contenu est : ", e.target.textContent);
});
```

### Récuperer plusieurs éléments d'un coup

Pour récuperer plusieurs éléments d'un coup, on utilise la méthode `querySelectorAll`. Par exemple pour récuperer tous les éléments `li` de la page :

```javascript
const tousLesLi = document.querySelectorAll("li");
```

On peut ensuite parcourir la liste des éléments récuperés pour les manipuler.

```javascript
tousLesLi.forEach((li) => {
  // Par exemple on ajoute un ecouteur de clic à chaque élément
  li.addEventListener("click", function () {
    console.log("L'élément a été cliqué !");
  });
});
```

### Créer un élément et l'inserer dans le DOM

Pour créer un élément, on utilise la méthode `createElement` de `document`. Par exemple pour créer un élément `li`, en général on modifie ensuite ses propriétés (comme son contenu, ses classes, etc.) avant de l'insérer dans le DOM. Pour l'inserer dans le DOM on doit d'abort récuperer l'élément dans lequel on veut l'insérer, puis utiliser la méthode `appendChild` de cet élément.

```javascript
// Creation de l'élément
const monElement = document.createElement("li");

// Modification de ses propriétés
monElement.textContent = "Nouvel élément";
monElement.classList.add("underline");
//etc ...

// Insertion dans le DOM
// Etape 1 : Je récupere l'element qui va contenir mon nouvel élément
const maListe = document.getElementById("maListe");

// Etape 2 : J'insere mon nouvel élément dans ma liste
maListe.appendChild(monElement);
```

### Savoir utiliser les templates

Il peut etre fastidieux de créer des structures HTML complexes en utilisant `createElement` pour chaque élément. Pour faciliter cela, on peut utiliser les templates HTML. Un template est un élément HTML qui n'est pas affiché, mais qui peut etre cloné pour créer des éléments visibles.

L'utilisation d'un template peut se découper en 3 étapes :

- Etape 1 : On récupère le template et on le clone
- Etape 2 : On modifie les propriétés du clone
- Etape 3 : On insere le clone dans le DOM

Exemple :

```html
<div id="fruits-list">
  <!-- Ici on va insérer les fruits -->
</div>

<template id="fruit-template">
  <article class="card">
    <h2 class="card-title" slot="fruit-name">NOM_DU_FRUIT</h2>
    <footer class="card-footer">
      <p class="card-footer-item">
        Quantité : <span slot="fruit-quantity">QUANTITE_DU_FRUIT</span>
      </p>
      <p class="card-footer-item">
        Prix à l'unité : <span slot="fruit-price">PRIX_DU_FRUIT</span>€
      </p>
    </footer>
  </article>
</template>
```

```javascript
// Etape 1 : On récupère le template et on le clone
const template = document.getElementById("fruit-template");
const clone = template.content.cloneNode(true); // true pour récuperer les elements enfants du template

// Etape 2 : On modifie les propriétés du clone
clone.querySelector("[slot='fruit-name']").textContent = "Pomme";
clone.querySelector("[slot='fruit-quantity']").textContent = "5";
clone.querySelector("[slot='fruit-price']").textContent = "1.5";

// Etape 3 : On insere le clone dans le DOM
document.getElementById("fruits-list").appendChild(clone);
```

### Récuperer les données d'un formulaire

Pour récuperer les données d'un formulaire on procède en deux étapes :

- Etape 1 : On ajoute un ecouteur de soumission au formulaire
- Etape 2 : Dans la fonction de l'ecouteur, on récuperer les données du formulaire grace a FormData

```html
<form id="mon-formulaire">
  <input type="text" name="fruit-name" />
  <input type="number" name="fruit-quantity" />
  <input type="number" name="fruit-price" />
  <button type="submit">Ajouter</button>
</form>
```

```javascript
// Etape 1 : On ajoute un ecouteur de soumission au formulaire
const monFormulaire = document.getElementById("mon-formulaire");
monFormulaire.addEventListener("submit", function (e) {
  e.preventDefault(); // On empeche le formulaire de se soumettre

  // Etape 2 : Dans la fonction de l'ecouteur, on récuperer les données du formulaire grace a FormData
  const formData = new FormData(monFormulaire);
  const data = Object.fromEntries(formData.entries());
  console.log(data);

  // On peut ensuite utiliser ces données pour faire une requête AJAX par exemple
});
```

## Requêtes Fetch

### Requête GET

Pour faire une requête GET, on utilise la fonction `fetch`. Cette fonction prend en argument l'URL de la ressource à récuperer, et retourne une réponse sous forme de promesse. On peut ensuite utiliser la méthode `json` de la réponse pour récuperer le contenu de la réponse sous forme d'objet javascript.

```javascript
const response = await fetch("https://mon-api.com/fruits");
const data = await response.json();

console.log(data);
```

### Requête POST

Pour faire une requête POST, on utilise la fonction `fetch` en lui passant un deuxième argument qui contient les options de la requête. Les options sont un objet javascript qui contient les propriétés de la requête, comme le corps de la requête, les entetes, etc.

```javascript
const response = await fetch("https://mon-api.com/fruits", {
  method: "POST", // On précise la méthode de la requête
  headers: {
    "Content-Type": "application/json",
  }, // On précise qu'on va envoyer du JSON
  body: JSON.stringify({
    name: "Pomme",
    quantity: 5,
    price: 1.5,
  }), // On précise le corps de la requête
});
```
